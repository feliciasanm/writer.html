function Keymap(a){this.map={};if(a)for(name in a)this.bind(name,a[name])}Keymap.prototype.bind=function(a,c){this.map[Keymap.normalize(a)]=c};Keymap.prototype.unbind=function(a){delete this.map[Keymap.normalize(a)]};Keymap.prototype.install=function(a){function c(c){return b.dispatch(c,a)}var b=this;a.addEventListener?a.addEventListener("keydown",c,!1):a.attachEvent&&a.attachEvent("onkeydown",c)};
Keymap.prototype.dispatch=function(a,c){var b="",d=null;a.altKey&&(b+="alt_");a.ctrlKey&&(b+="ctrl_");a.metaKey&&(b+="meta_");a.shiftKey&&(b+="shift_");if(d=a.key?a.key:a.keyIdentifier&&"U+"!==a.keyIdentifier.substring(0,2)?a.keyIdentifier:Keymap.keyCodeToKeyName[a.keyCode])if(b+=d.toLowerCase(),"ctrl_control"===b&&(b="ctrl"),/alt.*\_alt/.test(b)&&(b=b.replace(/alt_/,"")),b=b.replace(/shift_shift/,"shift"),d=this.map[b])return b=d.call(c,a,b),!1===b&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=
!0,a.preventDefault?a.preventDefault():a.returnValue=!1),b};Keymap.normalize=function(a){a=a.toLowerCase();a=a.split(/\s+|[\-+_]/);var c=a.pop(),c=Keymap.aliases[c]||c;a.sort();a.push(c);return a.join("_")};Keymap.aliases={escape:"esc","delete":"del","return":"enter",ctrl:"control",space:"spacebar",ins:"insert"};
Keymap.keyCodeToKeyName={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",
97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};